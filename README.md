# Kinship Graph Visualization

A Python script to visualize kinship groups from PLINK genome files as graphs. The script allows customization of thresholds, visualization parameters, and includes haplogroup information in the graphs.

## Features

- Visualizes kinship relationships based on PI_HAT and Z1 values.
- Assigns colors to edges based on user-defined thresholds.
- Assigns colors to nodes based on Y and/or MT haplogroup information.
- Customizable visualization parameters (edge width, node size, DPI, figure size, image format).
- Filters out nodes with high degrees and isolates.
- Adds legends to the graphs.

## Installation

Clone the repository and install the required Python packages.

```bash
git clone https://github.com/alekseizarubin/kinship-graph-visualization.git
cd kinship-graph-visualization
pip install -r requirements.txt
```

## Requirements

- Python 3.6 or higher
- Packages listed in `requirements.txt`:
  - pandas
  - numpy
  - matplotlib
  - networkx
  - argparse

## Usage

```bash
python visualize_kinship_graph.py genome_file.genome [options]
```

### Required Arguments

- `genome_file.genome`: Path to the PLINK genome file.

### Optional Arguments

```
--output OUTPUT
                        Prefix for output graph image files. Default is
                        'kinship_graph'.
--dpi DPI               Resolution of the output image in dots per inch
                        (DPI). Default is 100.
--figsize WIDTH HEIGHT  Figure size in inches (width height). Default is
                        [10, 8].
--fontsize FONTSIZE     Font size for labels. Default is 12.
--edge-width EDGE_WIDTH
                        Width of the edges in the graph. Default is 2.
--node-size NODE_SIZE   Size of the nodes in the graph. Default is 500.
--format {png,tiff,jpeg}
                        Format to save the output image. Choices are 'png',
                        'tiff', 'jpeg'. Default is 'png'.
--max-degree-fraction MAX_DEGREE_FRACTION
                        Maximum allowed fraction of connections per sample.
                        Samples with higher fraction will be excluded.
--threshold1 THRESHOLD1
                        PI_HAT threshold for color 1. Default is 0.75.
--threshold2 THRESHOLD2
                        PI_HAT lower threshold for colors 2 and 3. Default
                        is 0.4.
--z1-threshold Z1_THRESHOLD
                        Z1 threshold for distinguishing between colors 2 and
                        3. Default is 0.75.
--haplogroup-Y HAPLOGROUP_Y
                        Path to the file containing Y haplogroup
                        information.
--haplogroup-MT HAPLOGROUP_MT
                        Path to the file containing MT haplogroup
                        information.
--legend                Add legend to the image.
```

### Examples

**Basic Usage:**

```bash
python visualize_kinship_graph.py examples/example_genome_file.genome     --output kinship_graph     --haplogroup-MT examples/example_haplogroup_MT.tsv     --haplogroup-Y examples/example_haplogroup_Y.tsv     --legend
```

**Adjusting Visualization Parameters:**

```bash
python visualize_kinship_graph.py examples/example_genome_file.genome     --output kinship_graph_custom     --dpi 300     --figsize 15 15     --fontsize 11     --edge-width 3     --node-size 700     --format tiff     --haplogroup-MT examples/example_haplogroup_MT.tsv     --haplogroup-Y examples/example_haplogroup_Y.tsv     --legend
```

**Changing Thresholds:**

```bash
python visualize_kinship_graph.py examples/example_genome_file.genome     --output kinship_graph_thresholds     --threshold1 0.8     --threshold2 0.5     --z1-threshold 0.8     --haplogroup-MT examples/example_haplogroup_MT.tsv     --haplogroup-Y examples/example_haplogroup_Y.tsv     --legend
```

## Input File Formats

### PLINK Genome File

The genome file should be generated by PLINK's `--genome` option. It must contain the following columns:

- `FID1`, `IID1`: Family and individual ID of the first sample.
- `FID2`, `IID2`: Family and individual ID of the second sample.
- `PI_HAT`: Proportion of IBD (identity by descent) alleles.
- `Z1`: Proportion of pairs of alleles that are IBD at one allele.

### Haplogroup Files

Haplogroup files should be tab-delimited text files with two columns:

1. **Sample**: Sample ID matching the `IID` in the genome file.
2. **Haplogroup**: The haplogroup designation.

**Example:**

```plaintext
Sample1    H1
Sample2    H2a
Sample3
Sample4    H3
```

- Samples without haplogroup information should have an empty second column or a placeholder.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

